# Canvas 选中逻辑测试指南

## 测试步骤

### 1. 测试 text 元素选中

1. 启动应用 `npm run dev`
2. 从左侧面板拖入一个 **Text** 元素到 timeline
3. **不要**先在 timeline 点击选中
4. 直接在 Canvas 上点击 text 元素
5. ✅ **预期结果**：text 元素被选中，周围出现蓝色边框和控制手柄

### 2. 测试 solid 元素选中

1. 从左侧面板拖入一个 **Solid** 元素到 timeline
2. **不要**先在 timeline 点击选中
3. 直接在 Canvas 上点击 solid 元素
4. ✅ **预期结果**：solid 元素被选中，周围出现蓝色边框和控制手柄

### 3. 测试重叠元素（图层顺序）

1. 在 timeline 创建两个元素：
   - Track 1: 一个大的 Solid 元素（红色）
   - Track 2: 一个小的 Text 元素（在红色上面）
2. 点击两个元素重叠的区域
3. ✅ **预期结果**：应该选中 Track 2 的 Text（上层元素）

### 4. 测试旋转元素

1. 选中一个元素
2. 使用旋转手柄旋转元素 45 度
3. 取消选中
4. 再次点击旋转后的元素
5. ✅ **预期结果**：即使旋转了，仍然能精确选中

### 5. 测试空白区域

1. 点击 Canvas 的空白区域
2. ✅ **预期结果**：所有元素取消选中

### 6. 测试点击即拖动

1. 点击一个元素并按住不放
2. 移动鼠标
3. ✅ **预期结果**：元素被选中并立即开始拖动（无需二次点击）

### 7. 测试控制手柄

1. 选中一个元素
2. 点击蓝色边框或控制手柄
3. ✅ **预期结果**：不会触发重新选中，直接进入对应的变换模式

## 调试技巧

### 查看控制台日志

打开浏览器控制台，应该能看到：

```
[InteractiveCanvas] Clicked item: item-xxx
```

或者点击空白区域时：

```
[InteractiveCanvas] Clicked empty area, deselecting
```

### 检查 properties

在控制台输入：

```javascript
// 假设你的 Redux DevTools 可用
window.__REDUX_DEVTOOLS_EXTENSION__.getState()
```

检查选中元素的 `properties` 字段：

```json
{
  "x": 0,
  "y": 0,
  "width": 1,
  "height": 1,
  "rotation": 0,
  "opacity": 1
}
```

## 已知问题

如果仍然无法选中元素，检查：

1. **元素是否在当前帧可见**
   - 检查 timeline 的播放头位置
   - 元素的时间范围是否包含当前帧

2. **元素是否被其他元素完全遮挡**
   - 如果上层有全屏元素，下层元素无法被选中

3. **控制台是否有错误**
   - 检查是否有 TypeScript 或运行时错误

## 成功标准

所有 7 个测试场景都应该通过 ✅
